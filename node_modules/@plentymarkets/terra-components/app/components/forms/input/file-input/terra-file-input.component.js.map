{"version":3,"sources":["app/components/forms/input/file-input/terra-file-input.component.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA,sCAKuB;AACvB,6CAAkD;AAClD,6BAAyC;AACzC,wCAAmD;AACnD,kEAA+D;AAC/D,oCASyB;AAEzB,IAAI,MAAM,GAAU,CAAC,CAAC;AActB;IAA6C,2CAAmB;IAoC5D,iCAAoB,WAA8B,EAAU,uBAAmD;QAA/G,YAEI,kBAAM,aAAU,CAAC,KAAK,CAAC,SA0B1B;QA5BmB,iBAAW,GAAX,WAAW,CAAmB;QAAU,6BAAuB,GAAvB,uBAAuB,CAA4B;QAjCxG,sBAAgB,GAAW,KAAK,CAAC;QAGjC,4BAAsB,GAAY,EAAE,CAAC;QAGrC,uBAAiB,GAAW,IAAI,CAAC;QAsBhC,wBAAkB,GAAU,gBAAgB,CAAC;QASjD,wCAAwC;QACxC,KAAI,CAAC,GAAG,GAAG,iBAAe,MAAM,EAAI,CAAC;QAErC,KAAI,CAAC,oBAAoB,GAAG;YACxB,IAAI,EAAW,cAAc;YAC7B,OAAO,EAAQ,KAAI,CAAC,WAAW,CAAC,SAAS,CAAC,KAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC;YAC9E,UAAU,EAAK,IAAI;YACnB,aAAa,EAAE;gBAEI,KAAI,CAAC,KAAK,GAAG,KAAI,CAAC,kBAAkB,CAAC;gBACrC,KAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;YAC/B,CAAC;SACnB,CAAC;QAEF,KAAI,CAAC,sBAAsB,GAAG;YAC1B,IAAI,EAAW,YAAY;YAC3B,OAAO,EAAQ,KAAI,CAAC,WAAW,CAAC,SAAS,CAAC,KAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC;YAC9E,UAAU,EAAK,KAAK;YACpB,aAAa,EAAE;gBAEI,KAAI,CAAC,kBAAkB,GAAG,KAAI,CAAC,KAAK,CAAC;gBACrC,KAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;YAC/B,CAAC;SACnB,CAAC;;IACN,CAAC;gCAhEQ,uBAAuB;IAYhC,sBAAW,yDAAoB;aAK/B;YAEI,MAAM,CAAC,IAAI,CAAC,gBAAgB,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;QACnE,CAAC;aARD,UAAgC,QAAuC;YAEnE,IAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC;QACrC,CAAC;;;OAAA;IAmDM,wDAAsB,GAA7B,UAA8B,cAAiC;QAE3D,EAAE,CAAA,CAAC,wBAAiB,CAAC,cAAc,CAAC,IAAI,cAAc,CAAC,WAAW,CAAC,CACnE,CAAC;YACG,IAAI,CAAC,oBAAoB,CAAC,UAAU,GAAG,IAAI,CAAC;QAChD,CAAC;QACD,IAAI,CACJ,CAAC;YACG,IAAI,CAAC,oBAAoB,CAAC,UAAU,GAAG,KAAK,CAAC;YAC7C,IAAI,CAAC,kBAAkB,GAAG,cAAc,CAAC,SAAS,CAAC;QACvD,CAAC;IACL,CAAC;IAEM,kDAAgB,GAAvB;QAEI,EAAE,CAAA,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAC/B,CAAC;YACG,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,CAAC;QACtC,CAAC;IACL,CAAC;IAEM,iDAAe,GAAtB;QAEI,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;IAC/B,CAAC;IAEM,8CAAY,GAAnB,UAAoB,QAAe;QAE/B,EAAE,CAAA,CAAC,wBAAiB,CAAC,QAAQ,CAAC,CAAC,CAC/B,CAAC;YACG,MAAM,CAAC,EAAE,CAAC;QACd,CAAC;QAED,EAAE,CAAA,CAAC,aAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CACpC,CAAC;YACG,MAAM,CAAC,aAAa,CAAC;QACzB,CAAC;QACD,MAAM,CAAC,WAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;IAC3C,CAAC;IAEM,4CAAU,GAAjB,UAAkB,QAAe;QAE7B,MAAM,CAAC,CAAC,wBAAiB,CAAC,QAAQ,CAAC,IAAI,WAAQ,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;IACzE,CAAC;IAEM,6CAAW,GAAlB,UAAmB,IAAW;QAE1B,EAAE,CAAA,CAAC,wBAAiB,CAAC,IAAI,CAAC,CAAC,CAC3B,CAAC;YACG,MAAM,CAAC,EAAE,CAAC;QACd,CAAC;QACD,MAAM,CAAC,aAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IACrC,CAAC;IAnHD;QADC,YAAK,EAAE;;qEACgC;IAGxC;QADC,YAAK,EAAE;;2EACoC;IAG5C;QADC,YAAK,EAAE;;sEACgC;IAGxC;QADC,YAAK,EAAE;kCACiC,KAAK;yCAAL,KAAK;uEAG7C;IAQD;QADC,gBAAS,CAAC,SAAS,CAAC;kCACN,wBAAqB;4DAAC;IAGrC;QADC,gBAAS,CAAC,gBAAgB,CAAC;kCACN,wBAAqB;mEAAC;IA1BnC,uBAAuB;QAZnC,gBAAS,CAAC;YACP,QAAQ,EAAG,kBAAkB;YAC7B,QAAQ,EAAG,OAAO,CAAC,mCAAmC,CAAC;YACvD,MAAM,EAAK,CAAC,OAAO,CAAC,mCAAmC,CAAC,CAAC;YACzD,SAAS,EAAE;gBACP;oBACI,OAAO,EAAM,yBAAiB;oBAC9B,WAAW,EAAE,iBAAU,CAAC,cAAM,OAAA,yBAAuB,EAAvB,CAAuB,CAAC;oBACtD,KAAK,EAAQ,IAAI;iBACpB;aACJ;SACJ,CAAC;yCAqCkC,iCAAkB,EAAkC,8BAA2B;OApCtG,uBAAuB,CAuHnC;IAAD,8BAAC;;CAvHD,AAuHC,CAvH4C,2CAAmB,GAuH/D;AAvHY,0DAAuB","file":"app/components/forms/input/file-input/terra-file-input.component.js","sourcesContent":["import {\n    Component,\n    forwardRef,\n    Input,\n    ViewChild\n} from '@angular/core';\nimport { TranslationService } from 'angular-l10n';\nimport { isNullOrUndefined } from 'util';\nimport { NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { TerraInputComponent } from '../terra-input.component';\nimport {\n    FileType,\n    PathHelper,\n    TerraBaseStorageService,\n    TerraFrontendStorageService,\n    TerraOverlayButtonInterface,\n    TerraOverlayComponent,\n    TerraRegex,\n    TerraStorageObject\n} from '../../../../../';\n\nlet nextId:number = 0;\n\n@Component({\n    selector:  'terra-file-input',\n    template:  require('./terra-file-input.component.html'),\n    styles:    [require('./terra-file-input.component.scss')],\n    providers: [\n        {\n            provide:     NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => TerraFileInputComponent),\n            multi:       true\n        }\n    ]\n})\nexport class TerraFileInputComponent extends TerraInputComponent\n{\n    @Input()\n    public inputShowPreview:boolean = false;\n\n    @Input()\n    public inputAllowedExtensions:string[] = [];\n\n    @Input()\n    public inputAllowFolders:boolean = true;\n\n    @Input()\n    public set inputStorageServices(services:Array<TerraBaseStorageService>)\n    {\n        this._storageServices = services;\n    }\n\n    public get inputStorageServices():Array<TerraBaseStorageService>\n    {\n        return this._storageServices || [this._frontendStorageService];\n    }\n\n    @ViewChild('overlay')\n    public overlay:TerraOverlayComponent;\n\n    @ViewChild('previewOverlay')\n    public previewOverlay:TerraOverlayComponent;\n\n    public primaryOverlayButton:TerraOverlayButtonInterface;\n    public secondaryOverlayButton:TerraOverlayButtonInterface;\n\n    private _translationPrefix:string = 'terraFileInput';\n    private _storageServices:Array<TerraBaseStorageService>;\n    private _selectedObjectUrl:string;\n    private _id:string;\n\n    constructor(private translation:TranslationService, private _frontendStorageService:TerraFrontendStorageService)\n    {\n        super(TerraRegex.MIXED);\n\n        // generate the id of the input instance\n        this._id = `file-input_#${nextId++}`;\n\n        this.primaryOverlayButton = {\n            icon:          'icon-success',\n            caption:       this.translation.translate(this._translationPrefix + '.choose'),\n            isDisabled:    true,\n            clickFunction: ():void =>\n                           {\n                               this.value = this._selectedObjectUrl;\n                               this.overlay.hideOverlay();\n                           }\n        };\n\n        this.secondaryOverlayButton = {\n            icon:          'icon-close',\n            caption:       this.translation.translate(this._translationPrefix + '.cancel'),\n            isDisabled:    false,\n            clickFunction: ():void =>\n                           {\n                               this._selectedObjectUrl = this.value;\n                               this.overlay.hideOverlay();\n                           }\n        };\n    }\n\n    public onSelectedObjectChange(selectedObject:TerraStorageObject):void\n    {\n        if(isNullOrUndefined(selectedObject) || selectedObject.isDirectory)\n        {\n            this.primaryOverlayButton.isDisabled = true;\n        }\n        else\n        {\n            this.primaryOverlayButton.isDisabled = false;\n            this._selectedObjectUrl = selectedObject.publicUrl;\n        }\n    }\n\n    public onPreviewClicked():void\n    {\n        if(this.isWebImage(this.value))\n        {\n            this.previewOverlay.showOverlay();\n        }\n    }\n\n    public showFileBrowser():void\n    {\n        this.overlay.showOverlay();\n    }\n\n    public getIconClass(filename:string):string\n    {\n        if(isNullOrUndefined(filename))\n        {\n            return '';\n        }\n\n        if(PathHelper.isDirectory(filename))\n        {\n            return 'icon-folder';\n        }\n        return FileType.mapIconClass(filename);\n    }\n\n    public isWebImage(filename:string):boolean\n    {\n        return !isNullOrUndefined(filename) && FileType.isWebImage(filename);\n    }\n\n    public getFilename(path:string):string\n    {\n        if(isNullOrUndefined(path))\n        {\n            return '';\n        }\n        return PathHelper.basename(path);\n    }\n}\n"],"sourceRoot":"/source/"}