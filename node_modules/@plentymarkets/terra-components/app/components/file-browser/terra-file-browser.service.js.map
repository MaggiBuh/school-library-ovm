{"version":3,"sources":["app/components/file-browser/terra-file-browser.service.ts"],"names":[],"mappings":"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","file":"app/components/file-browser/terra-file-browser.service.js","sourcesContent":["import {\n    Injectable,\n    NgZone\n} from '@angular/core';\nimport { BehaviorSubject } from 'rxjs/BehaviorSubject';\n\n@Injectable()\nexport class TerraFileBrowserService\n{\n    private _dropzones:Array<HTMLElement> = [];\n    private _globalListenersDefined:boolean = false;\n    private _dragenterTarget:EventTarget = null;\n\n    public isDragActive:BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n    constructor(private zone:NgZone)\n    {\n    }\n\n    public addDropzone(dropzone:HTMLElement):void\n    {\n        if(!this._globalListenersDefined)\n        {\n            this.setupGlobalListeners();\n        }\n        this._dropzones.push(dropzone);\n    }\n\n    public removeDropzone(dropzone:HTMLElement):void\n    {\n        let idx:number = this._dropzones.indexOf(dropzone);\n        if(idx >= 0)\n        {\n            this._dropzones.splice(idx, 1);\n        }\n    }\n\n    private isDropzone(element:HTMLElement):boolean\n    {\n        return this._dropzones.some(\n            (dropzone:HTMLElement) =>\n            {\n                return dropzone.contains(element);\n            }\n        )\n    }\n\n    private setupGlobalListeners():void\n    {\n        this.zone.runOutsideAngular(() =>\n        {\n            let setEffect = (event:DragEvent) =>\n            {\n                if(this.isDropzone(<HTMLElement>event.target))\n                {\n                    event.dataTransfer.effectAllowed = 'copy';\n                    event.dataTransfer.dropEffect = 'copy'\n                }\n                else\n                {\n                    event.dataTransfer.effectAllowed = 'none';\n                    event.dataTransfer.dropEffect = 'none'\n                }\n            };\n\n            window.addEventListener('dragenter', (event:DragEvent) =>\n            {\n                this._dragenterTarget = event.target;\n                event.preventDefault();\n                if(!this.isDragActive.value)\n                {\n                    this.isDragActive.next(true);\n                }\n            });\n\n            window.addEventListener('dragover', (event:DragEvent) =>\n            {\n                event.preventDefault();\n                setEffect(event);\n            });\n\n            window.addEventListener('dragleave', (event:DragEvent) =>\n            {\n                if(event.target === this._dragenterTarget)\n                {\n                    this._dragenterTarget = null;\n                    this.isDragActive.next(false);\n                }\n            });\n\n            window.addEventListener('drop', (event:DragEvent) =>\n            {\n                event.preventDefault();\n                this._dragenterTarget = null;\n                if(this.isDragActive.value)\n                {\n                    this.isDragActive.next(false);\n                }\n            });\n\n        });\n        this._globalListenersDefined = true;\n    }\n}"],"sourceRoot":"/source/"}