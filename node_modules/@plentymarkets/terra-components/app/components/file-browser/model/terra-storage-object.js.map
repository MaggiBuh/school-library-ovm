{"version":3,"sources":["app/components/file-browser/model/terra-storage-object.ts"],"names":[],"mappings":"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","file":"app/components/file-browser/model/terra-storage-object.js","sourcesContent":["import {\n    createS3StorageObject,\n    S3StorageObjectInterface\n} from './s3-storage-object.interface';\nimport { PathHelper } from '../helper/path.helper';\nimport { FileType } from '../helper/fileType.helper';\nimport { isNullOrUndefined } from 'util';\n\nexport class TerraStorageObject\n{\n    private _s3Object:S3StorageObjectInterface;\n    private _children:TerraStorageObject[] = [];\n    private _parent:TerraStorageObject;\n\n    public get eTag():string\n    {\n        return this._s3Object.eTag;\n    }\n\n    public get key():string\n    {\n        return this._s3Object.key;\n    }\n\n    public get publicUrl():string\n    {\n        return this._s3Object.publicUrl;\n    }\n\n    public get previewUrl():string\n    {\n        return this._s3Object.previewUrl || this._s3Object.publicUrl;\n    }\n\n    public get lastModified():Date\n    {\n        return new Date(this._s3Object.lastModified);\n    }\n\n    public get size():number\n    {\n        return this._s3Object.size;\n    }\n\n    public get sizeString():string\n    {\n        if(typeof this.size !== 'number')\n        {\n            return '0B';\n        }\n        return PathHelper.sizeString(this.size);\n    }\n\n    public get name():string\n    {\n        return PathHelper.basename(this._s3Object.key);\n    }\n\n    public get icon():string\n    {\n        if(this.isDirectory)\n        {\n            return 'icon-folder';\n        }\n\n        return FileType.mapIconClass(this.name);\n    }\n\n    public get isDirectory():boolean\n    {\n        return PathHelper.isDirectory(this._s3Object.key);\n    }\n\n    public get isFile():boolean\n    {\n        return PathHelper.isFile(this._s3Object.key);\n    }\n\n    public get parent():TerraStorageObject\n    {\n        return this._parent;\n    }\n\n    public get hasChildren():boolean\n    {\n        return this.isFile ? false : this._children.length > 0;\n    }\n\n    public get children():TerraStorageObject[]\n    {\n        if(this.isFile)\n        {\n            return [];\n        }\n\n        return this._children.sort((childA:TerraStorageObject, childB:TerraStorageObject) =>\n        {\n            if(childA.name > childB.name)\n            {\n                return -1;\n            }\n            if(childA.name < childB.name)\n            {\n                return 1;\n            }\n            return 0;\n        });\n    }\n\n    public get fileCount():number\n    {\n        if(this.isFile)\n        {\n            return 1;\n        }\n        else\n        {\n            return this.children\n                       .map((child:TerraStorageObject) =>\n                       {\n                           return child.fileCount;\n                       })\n                       .reduce((sum:number, current:number) =>\n                       {\n                           return sum + current;\n                       }, 0);\n        }\n    }\n\n    constructor(s3Object:S3StorageObjectInterface, parent?:TerraStorageObject)\n    {\n        this._s3Object = s3Object;\n        this._parent = parent;\n    }\n\n    public addChild(s3object:S3StorageObjectInterface, paths?:string[]):void\n    {\n        if(this.isFile)\n        {\n            console.error('Cannot add child object to file-like object.');\n            return;\n        }\n\n        paths = paths || s3object.key.split(PathHelper.DELIMITER);\n        while(paths.length > 0 && paths[0].length <= 0)\n        {\n            paths.shift();\n        }\n\n        let lastIdx:number = paths.length - 1;\n        while(lastIdx > 0 && paths[lastIdx].length <= 0)\n        {\n            paths.pop();\n            lastIdx--;\n        }\n\n        if(paths.length === 1)\n        {\n            let object:TerraStorageObject = new TerraStorageObject(s3object, this);\n            if(this.hasChild(object.name))\n            {\n                let idx:number = this._children.findIndex((child:TerraStorageObject) =>\n                {\n                    return child.name === object.name;\n                });\n                this._children[idx] = object;\n            }\n            else\n            {\n                this._children.push(object);\n            }\n        }\n        else\n        {\n            let nextPath:string = paths.shift();\n            let child:TerraStorageObject = this.getChild(nextPath);\n            if(!child)\n            {\n                let s3Object:S3StorageObjectInterface = createS3StorageObject(\n                    PathHelper.join(this.key, nextPath) + '/'\n                );\n                child = new TerraStorageObject(s3Object, this);\n                this.children.push(child);\n            }\n\n            child.addChild(s3object, paths);\n        }\n    }\n\n    public removeChild(key:string):void\n    {\n        let paths:string[] = this.splitKeyIntoPaths(key);\n        let nextPath:string = paths.shift();\n        let child:TerraStorageObject = this.getChild(nextPath);\n        if(child)\n        {\n            if(paths.length > 0)\n            {\n                child.removeChild(paths.join('/'));\n            }\n            else\n            {\n                let idx:number = this._children.indexOf(child);\n                this._children.splice(idx, 1);\n            }\n        }\n    }\n\n    public getChild(name:string):TerraStorageObject\n    {\n        return this._children.find((child:TerraStorageObject) =>\n        {\n            return child.name === name;\n        });\n    }\n\n    public hasChild(name:string):boolean\n    {\n        return this._children.some((child:TerraStorageObject) =>\n        {\n            return child.name === name;\n        });\n    }\n\n    public find(key:string):TerraStorageObject\n    {\n        if(isNullOrUndefined(key))\n        {\n            return null;\n        }\n\n        let paths:string[] = this.splitKeyIntoPaths(key);\n        let nextPath:string = paths.shift();\n        let child:TerraStorageObject = this.getChild(nextPath);\n        if(!isNullOrUndefined(child))\n        {\n            if(paths.length > 0)\n            {\n                return child.find(paths.join('/'));\n            }\n\n            return child;\n        }\n\n        return null;\n    }\n\n    private splitKeyIntoPaths(key:string):string[]\n    {\n        return key.split('/').filter((part:string):boolean => part.length > 0);\n    }\n}\n"],"sourceRoot":"/source/"}